---
title: Drizzle
description: Workflows Drizzle-kit par Environnement et commandes essentielles pour la gestion des bases de donn√©es
---

import { Callout } from "fumadocs-ui/components/callout";

## ‚ö° Commandes Drizzle-kit

| Commande                  | Description                                           | Usage Principal           |
| ------------------------- | ----------------------------------------------------- | ------------------------- |
| `drizzle-kit generate`    | G√©n√®re des fichiers de migration SQL                 | Changement de sch√©ma      |
| `drizzle-kit migrate`     | Applique les migrations √† la base de donn√©es         | Mise √† jour DB            |
| `drizzle-kit pull`        | Extrait le sch√©ma DB vers code Drizzle               | Import DB existante       |
| `drizzle-kit push`        | Pousse le sch√©ma sans cr√©er de migrations            | Prototypage rapide        |
| `drizzle-kit studio`      | Lance l'interface web d'exploration                  | D√©bogage visuel           |
| `drizzle-kit check`       | V√©rifie les conflits de migrations                   | Validation pr√©-production |
| `drizzle-kit up`          | Met √† jour les snapshots de migrations               | Mise √† jour Drizzle ORM   |

### D√©tails des Commandes

**`drizzle-kit generate`**
- Analyse les changements dans votre sch√©ma TypeScript
- Cr√©e des fichiers `.sql` versionn√©s dans `./drizzle`
- G√©n√®re les commandes SQL n√©cessaires

**`drizzle-kit migrate`**
- Ex√©cute s√©quentiellement les migrations non appliqu√©es
- Maintient l'historique des migrations ex√©cut√©es

**`drizzle-kit push`**
- Applique les changements SANS cr√©er de fichiers de migration
- Plus rapide mais sans historique de versions

**`drizzle-kit studio`**
- Interface visuelle pour explorer et modifier les donn√©es
- Permet l'ex√©cution de requ√™tes SQL interactives

---

## üîÑ Workflows par Environnement

### üöß D√©veloppement (Local)

**Workflow Rapide (Recommand√©)**

```bash
# 1. Modifier le sch√©ma dans schema.ts
# 2. Push direct sans migrations
npx drizzle-kit push

# 3. V√©rifier visuellement
npx drizzle-kit studio
```

**Workflow avec Migrations**

```bash
# 1. Modifier le sch√©ma
# 2. G√©n√©rer les migrations
npx drizzle-kit generate

# 3. V√©rifier les migrations
npx drizzle-kit check

# 4. Appliquer les migrations
npx drizzle-kit migrate

# 5. Explorer la DB
npx drizzle-kit studio
```

**Reset Complet**

```bash
# Option 1: Force push
npx drizzle-kit push --force

# Option 2: Drop et recr√©er
DROP SCHEMA public CASCADE;
CREATE SCHEMA public;
npx drizzle-kit push
```

### üß™ Pr√©prod/Staging

**Workflow Standard**

```bash
# 1. R√©cup√©rer les migrations
git pull

# 2. V√©rifier l'√©tat
npx drizzle-kit check

# 3. Dry run (optionnel)
npx drizzle-kit migrate --dry-run

# 4. Appliquer les migrations
npx drizzle-kit migrate

# 5. V√©rification
npx drizzle-kit studio
```

**Synchronisation Production**

```bash
# Pull le sch√©ma de prod
npx drizzle-kit pull --config=drizzle.config.prod.ts

# G√©n√©rer les migrations n√©cessaires
npx drizzle-kit generate

# Tester
npx drizzle-kit migrate
```

### üöÄ Production

**Workflow S√©curis√©**

```bash
# 1. Backup OBLIGATOIRE
pg_dump production_db > backup_$(date +%Y%m%d_%H%M%S).sql

# 2. V√©rification finale
npx drizzle-kit check

# 3. Application des migrations
npx drizzle-kit migrate

# 4. Tests de sant√©
# Monitoring et v√©rifications
```

**Pipeline CI/CD**

```yaml
deploy:
  steps:
    - name: Check migrations
      run: npx drizzle-kit check

    - name: Backup database
      run: ./scripts/backup-db.sh

    - name: Run migrations
      run: npx drizzle-kit migrate
      env:
        DATABASE_URL: ${{ secrets.PROD_DATABASE_URL }}

    - name: Verify migrations
      run: ./scripts/verify-migrations.sh
```

---

## üìã Bonnes Pratiques

| Environnement   | ‚úÖ √Ä faire                              | ‚ùå √Ä √©viter                  |
| --------------- | --------------------------------------- | ---------------------------- |
| **D√©veloppement** | `push` pour it√©ration rapide          | Commit des donn√©es de test   |
|                 | Reset DB fr√©quent                       | N√©gliger les tests           |
|                 | Tester les migrations avant commit     |                              |
| **Staging**     | `generate` + `migrate`                  | Ignorer les rollbacks        |
|                 | Tester les rollbacks                    | Donn√©es irr√©alistes          |
|                 | M√™mes migrations qu'en prod            |                              |
| **Production**  | **TOUJOURS** faire un backup           | **JAMAIS** utiliser `push`   |
|                 | Migrations test√©es en staging          | **JAMAIS** utiliser `--force`|
|                 | Plan de rollback pr√©par√©               | Migrations non test√©es       |

---

## üë• Workflow d'√âquipe

### Nouvelle Feature

```bash
# D√©veloppeur A
git checkout -b feature/new-table

# Modifier le sch√©ma puis g√©n√©rer
npx drizzle-kit generate

# Commit sch√©ma + migration
git add .
git commit -m "feat: add users table"
git push
```

### R√©cup√©ration des Changements

```bash
# D√©veloppeur B (apr√®s merge)
git pull
npx drizzle-kit migrate
```

### Gestion des Conflits

<Callout type="warning">
**Conflits de migrations**: Si deux d√©veloppeurs cr√©ent des migrations en parall√®le, suivez ces √©tapes pour r√©soudre les conflits.
</Callout>

```bash
# 1. Pull les migrations de main
git pull origin main

# 2. V√©rifier les conflits
npx drizzle-kit check

# 3. Si conflit, r√©g√©n√©rer
rm -rf drizzle/*_your_migration.sql
npx drizzle-kit generate

# 4. Tester et commit
npx drizzle-kit migrate
git add . && git commit -m "fix: resolve migration conflict"
```

---

## üéØ Comparaison: Push vs Generate+Migrate

| Aspect            | **Push**         | **Generate + Migrate** |
| ----------------- | ---------------- | ---------------------- |
| **Vitesse**       | ‚ö° Rapide        | ‚è≥ Plus lent           |
| **Historique**    | ‚ùå Aucun         | ‚úÖ Versionn√©           |
| **Rollback**      | ‚ùå Impossible    | ‚úÖ Possible            |
| **Utilisation**   | Dev uniquement  | Staging & Prod         |
| **Collaboration** | ‚ö†Ô∏è Difficile     | ‚úÖ Facile              |

<Callout type="success">
**R√®gle d'Or**

- **D√©veloppement** = Rapidit√© ‚Üí `push`
- **Staging** = Test du process ‚Üí `generate` + `migrate`  
- **Production** = S√©curit√© maximale ‚Üí `migrate` avec backup
</Callout>

## üìö Ressources Utiles

- [Documentation officielle Drizzle](https://orm.drizzle.team/)
- [Drizzle Kit Documentation](https://orm.drizzle.team/kit-docs/overview)
- [Migration Guide](https://orm.drizzle.team/docs/migrations)
- [Drizzle Studio](https://orm.drizzle.team/drizzle-studio/overview)

---

_Ce guide est un document vivant. N'h√©sitez pas √† le compl√©ter avec vos propres d√©couvertes et cas d'usage !_
